<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–û—Ü–µ–Ω–∫–∞ –¥–Ω—è</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(160deg, #c471f5, #fa71cd);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 20px;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 20px;
      text-align: center;
    }

    .rating-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-bottom: 30px;
    }

    .option {
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      color: #fff;
      background-color: rgba(255,255,255,0.1);
      cursor: pointer;
      transition: 0.3s;
    }

    .option.selected {
      outline: 3px solid #fff;
      background-color: rgba(255,255,255,0.3);
    }

    input, textarea {
      width: 100%;
      max-width: 500px;
      padding: 14px;
      margin-bottom: 18px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      background-color: #ffffffdd;
      color: #333;
      resize: vertical;
    }

    button {
      padding: 14px 26px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      background-color: #fff;
      color: #c471f5;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
    }

    .message {
      margin-top: 15px;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <h1>üìä –ö–∞–∫ –ø—Ä–æ—à—ë–ª —Ç–≤–æ–π –¥–µ–Ω—å?</h1>

  <div class="rating-group" id="ratingOptions">
    <button class="option" data-value="–û—Ç–ª–∏—á–Ω—ã–π">üü¢ –û—Ç–ª–∏—á–Ω—ã–π</button>
    <button class="option" data-value="–•–æ—Ä–æ—à–∏–π">üü° –•–æ—Ä–æ—à–∏–π</button>
    <button class="option" data-value="–ù–æ—Ä–º–∞–ª—å–Ω—ã–π">‚ö™ –ù–æ—Ä–º–∞–ª—å–Ω—ã–π</button>
    <button class="option" data-value="–ü–ª–æ—Ö–æ–π">üî¥ –ü–ª–æ—Ö–æ–π</button>
    <button class="option" data-value="–£–∂–∞—Å–Ω—ã–π">‚ö´ –£–∂–∞—Å–Ω—ã–π</button>
  </div>

  <input type="text" id="good" placeholder="–ß—Ç–æ –±—ã–ª–æ —Ö–æ—Ä–æ—à–æ?">
  <input type="text" id="bad" placeholder="–ß—Ç–æ –±—ã–ª–æ –ø–ª–æ—Ö–æ?">
  <input type="text" id="improve" placeholder="–ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å?">

  <button id="submitBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  <div class="message" id="resultMsg"></div>

  <script>
    const options = document.querySelectorAll(".option");
    let selectedRating = null;

    options.forEach(btn => {
      btn.addEventListener("click", () => {
        options.forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        selectedRating = btn.dataset.value;
      });
    });

    document.getElementById("submitBtn").addEventListener("click", () => {
      const good = document.getElementById("good").value;
      const bad = document.getElementById("bad").value;
      const improve = document.getElementById("improve").value;

      const tg = window.Telegram.WebApp;
      const userId = tg?.initDataUnsafe?.user?.id || "unknown";

      if (!selectedRating) {
        document.getElementById("resultMsg").textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ—Ü–µ–Ω–∫—É –¥–Ω—è.";
        return;
      }

      const payload = {
        user_id: userId,
        rating: selectedRating,
        good,
        bad,
        improve,
        timestamp: new Date().toISOString()
      };

      fetch('https://script.google.com/macros/s/AKfycbzq9m-4orNgcyitSQaTP6uT-xQVJLW4zN0MZWygtfiJKbGM26S6FavsGEoLoBvquKPHAQ/exec', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload)
      })
      .then(() => {
        const msg = [
          'üî• –î–µ–Ω—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!',
          'üí™ –û—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–∏–ª—Å—è!',
          'üëè –ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ ‚Äî –±–æ–ª—å—à–∏–µ –ø–æ–±–µ–¥—ã!',
          '‚ú® –¢—ã —É–∂–µ –ª—É—á—à–µ, —á–µ–º –±—ã–ª –≤—á–µ—Ä–∞!'
        ];
        document.getElementById("resultMsg").textContent = msg[Math.floor(Math.random() * msg.length)];
        document.getElementById("good").value = '';
        document.getElementById("bad").value = '';
        document.getElementById("improve").value = '';
        options.forEach(b => b.classList.remove("selected"));
        selectedRating = null;
      })
      .catch(() => {
        document.getElementById("resultMsg").textContent = "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.";
      });
    });
  </script>
</body>
</html>
